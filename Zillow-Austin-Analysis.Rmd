---
title: "Analysis of Zillow Data from Austin, Texas"
author: "Will Curkan"
date: "2022-12-16"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, echo = F, warning=F, message=F, include=F}
library(dplyr, quietly = T)
library(ggplot2, quietly = T)
```

## Introduction

Austin, a hilly city due south in the middle of Texas, is where all the young, hip Texans and out-of-staters are converging to live. Other than its famous $6^{th}$ street nightlife, the "weird" city is home to many "corporate and regional headquarters" from companies like Dell, IBM, Facebook, VISA and many more [1] - these are some great reasons to "kick up the roots" and mosey on over to Austin!
Suppose you think that you are *just* young and hip enough to move out to Austin, you might want some insights on how the housing market is.

## Objective Statement

The objective of this project is to explore the dataset, make inferences about true statistic parameters in Austin, Texas, and to make predictions on housing prices and categories like "which broker is listing the property".

## Data Acquisition and Explanation

```{r load data, echo = F}
set.seed(2022)
data <- read.csv('Zillow_Austin_11-16-22.csv')
#head(data)
#dim(data)
```
Alex Huggler on Kaggle.com provides Zillow Housing data for November 2022 on Kaggle.com [2]. The data has 800 unique observations and 20 features: one observation per unique housing unit and each feature as some trait of the house like its zip code or number of bedrooms.

### Feature Descriptions

The following features will be used in analysis of Austin housing prices:

|Feature|Description|
|-------|-----------|
|price| price of housing|
|addressCity| City name|
|addressZip| Zip code|
|beds| Number of beds|
|baths| Number of baths|
|area| Sq. foot|
|latitude| Latitude|
|longitude| Longitude|
|variableData| String of description from Zillow|
|sgapt| For Sale by broker OR new construction (categ.)|
|zestimate| Zillow how price estimate|
|brokerName| Who sells the house|

Features from the dataset have been removed for this analysis. The feature `unformattedPrice` is removed because it is the same as `price`. `address` and `addressStreet` are removed as they will not be useful in analysis or prediction because they're all unique and non-numeric. `addressState` only had the value "Texas". `isZillowOwned` is only FALSE as Zillow does not own any of the properties. `badgeInfo` is undefined and is NULL. `pgapt` is all "For Sale".
`info3string` is a link to a picture of a house.

```{r subsetted data, echo = F}
zillow_dat <- data %>%
  select(!c(unformattedPrice, address, addressStreet, addressState,
         isZillowOwned, badgeInfo, pgapt, info3String))

# head(zillow_dat)
```

```{r hist of price feat}
# hist(zillow_dat$price)
```

## EDA


### Checking Cities
We did not need the `addressState` column because it only had one value: Texas. We might assume that `addressCity` is only Austin and remove the feature, but is there another city in the dataset?

```{r check cities, echo = F, eval = F}
zillow_dat %>%
  # group by category
  group_by(addressCity) %>% 
  # Count the number of values assocuated with the category
  summarize(n = n()) %>%
  # Most listings first
  arrange(desc(n))
```
|City| Listings|
|----|---------|
|Austin|	786			
|Del Valle|	8			
|Pflugerville|	3			
|Lakeway|	1			
|Manor|	1			
|Terlingua|	1	

There are a few other cities represented in this dataset, so we will keep this column for now.

### Brand-New or Old house

It is also interesting to know which houses are being sold and under construction, or are for sale by a broker.

```{r new or old house (house type), echo = F, eval = F}
zillow_dat %>%
  # group by category
  group_by(sgapt) %>% 
  # Count the number of values assocuated with the category
  summarize(n = n()) %>%
  # Most listings first
  arrange(desc(n))
```
|Listing type| Listings|
|----------|---------|
|For Sale (Broker)|	755			
|New Construction|	45

Most of the houses for sale have already been built. Lets see if there is a price different between the types of listings.

```{r listing type boxp, echo = F}
ggplot(zillow_dat, aes(x = sgapt, y = log(price), fill = sgapt)) +
  geom_boxplot() +
  labs(x = 'Listing Type', y = 'Log price',
       title = 'Log Price by Listing Type', fill = 'Listing type') +
  theme(plot.title = element_text(size=20))
```
Looks like buying a new house tends to cost more than one already for sale by a broker, but recall that this is the *log price*.

So, let's look at the mean housing price of both listing types.

```{r listing type means, echo = F, eval = F}
zillow_dat %>%
  # group by category
  group_by(sgapt) %>% 
  # Count the number of values assocuated with the category
  summarize(mean(price))
```
|Listing type| Mean price|
|------------|-----------|
|For Sale (Broker)|	915,297.9			
|New Construction|	1,882,131.2

Looking at the mean price of the listing types is disheartening, not only do you have to be hip to live in Austin, but you have to be rich too? The mean prices of the two listing types are quite high, and we see from the boxplot that the data is skewed, so let's employ some resampling techniques to get an estimate on the true mean house prices.

It might be worth taking a closer look at the normality of the data.

```{r Histograms of Listing Types, echo = F, warning=F}
ggplot(zillow_dat, aes(x = log(price))) + 
  geom_histogram(binwidth = .1) +
  facet_wrap(~sgapt) +
  labs(title = 'Facet Histograms of Listing Types',
       x = 'Log price', y = 'Frequency')
```

We can already observe the skewedness of the Broker sale data from the boxplot, but it is hard to tell the shape of the "New Construction" data.

```{r New Construction Listing Hist, echo = F}
options(scipen=5) # Remove scientific notation from histogram
ggplot(subset(zillow_dat, sgapt == 'New Construction'),
       aes(x = price)) + geom_histogram(bins = 100) +
  labs(title = "Histogram of 'New Construction' Listing Prices",
       x = 'Price', y = 'Frequency')
  
```

So, there are quite a few houses over the million dollar price range... And the most expensive house is $11,250,800. These probably for Elon Musk and his pals, though.

```{r Huge outlier listing in New Construction, echo = F, eval = F}
outlier_listing <- zillow_dat %>%
  filter(sgapt == 'New Construction') %>%
  arrange(desc(price)) %>%
  head(1)

# outlier_listing$price
```

Let's look at an estimate for the true mean house prices of both listing types.

```{r bootstrap mean Broker sale, echo = F, eval = F}
################## Bootstrap percentile technique #####################
#######################################################################
subset_brokerSale <- zillow_dat %>%
  filter(sgapt == 'For Sale (Broker)') %>%
  select(price)

subset_brokerSale <- as.numeric(unlist(subset_brokerSale))
# class(subset_brokerSale)

# Length (number) of observations
# Dataframe will use nrow instead of length
n <- length(subset_brokerSale)

# Resample iterations
N <- 10^4

# Bootstrap mean container
boot.mean <- numeric(N)

# Bootstrap
for(i in 1:N)
{
  # Resample
  x <- sample(subset_brokerSale, n, replace = T)
  # Bootstrap means
  boot.mean[i] <- mean(x)
}

quantile(boot.mean, c(.025,.975))

abs((mean(boot.mean) - 915297.9) / sd(boot.mean))
```
We are 95% confident in saying that the true mean housing price in Austin is between (820715.3 1021421.0) and our bias percentage shows the sample mean may well represent the true mean, with the bias being only .6%. But we actually want people to move to Austin, so let's check out the median and see if we get a more reasonable price.


```{r}

```

ARE gouging for new houses?


### Top Brokers
First, let's look at the top 5 brokers with the most listings.

```{r top 5 brokers, echo = F}
top_5_brokers <- zillow_dat %>%
  # group by category
  group_by(brokerName) %>% 
  # Count the number of values assocuated with the category
  summarize(n = n()) %>%
  # Most listings first
  arrange(desc(n)) %>%
  head(5)

# top_5_brokers
# sum(top_5_brokers$n)
```
| Broker| Listings|
|-------|---------|
|Realty Austin|	73			
|Keller Williams Realty|	67			
|Compass RE Texas, LLC|	60			
|Opendoor Brokerage, LLC|	32			
|Moreland Properties|	29	

Other than Keller Williams Realty, the other brokers are not huge names if you are not into the housing market. Let's explore the data relative to the top 5 brokers.

```{r subsetting brokers, echo = F}
by_top_5_brokers <- zillow_dat %>%
  filter(brokerName %in% top_5_brokers$brokerName)
```

```{r box top 5 brokers, echo = F}
ggplot(by_top_5_brokers, aes(x = brokerName, y = log(price), 
                             fill = brokerName)) +
  geom_boxplot() + 
  coord_flip() + 
  labs(title = 'Price Boxplots by Broker', y = 'Log price',
       x = 'Broker name')
```

It looks like Moreland Properties is selling the houses with the highest prices. Moreland is also has the fewest listings likely because they're so high priced.
Keller Williams, Austin Realty, and Compass RE look like they are doing similar business, though Compass has some huge outliers. If you are moving to the greater Austin area and your friend recommends using Moreland Properties, they probably think you are rich!

### References:

[1] https://www.austinchamber.com/economic-development/key-industries/corporate-headquarters

[2] https://www.kaggle.com/datasets/alexhuggler/austin-zillow-houses-for-sale